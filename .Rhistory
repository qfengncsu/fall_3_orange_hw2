katrina <- fread('/SurvivalHW/Data/katrina.csv')
# need these packages
library(data.table)
library(survival)
library(survminer)
library(muhaz)
katrina <- fread('/SurvivalHW/Data/katrina.csv')
katrina <- fread('SurvivalHW/Data/katrina.csv')
# need these packages
library(data.table)
library(survival)
library(survminer)
library(muhaz)
katrina <- fread('Survival Analysis/Data/katrina.csv')
# create a survival curve with no stratification
# survive==0 since we're interested in pump failure (non-survival)
katrina_fit <- survfit(Surv(katrina$hour, katrina$survive==0) ~ 1, data=katrina)
# calling this gives the sample size, #events (survive==0, failure), median, and CI
katrina_fit
# the summary gives us the time, number at risk, number of events,
summary(katrina_fit)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, conf.int = FALSE, palette = "grey")
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, conf.int = TRUE, palette = "grey")
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)", conf.int = TRUE, palette = "grey")
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "blue",
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "blue",
tables.theme = theme_cleantable()
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "#E7B800",
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "grey",
)
# stratify by reason and plot
katrina_reason <- survfit(Surv(katrina$hour, katrina$survive==0) ~ katrina$reason, data = katrina)
ggsurvplot(katrina_reason, conf.int = FALSE, color="strata")
ggsurvplot(katrina_reason, conf.int = FALSE,
color=c("#e41a1c","#377eb8", "#4daf4a", "#984ea3","#ff7f00")
#ffff33
#a65628
#f781bf)
)
ggsurvplot(katrina_reason, conf.int = FALSE,
color='Strata'
)
ggsurvplot(katrina_reason, conf.int = FALSE,
palette='Strata'
)
# stratify by reason and plot
katrina_reason <- survfit(Surv(katrina$hour, katrina$survive==0) ~ katrina$reason, data = katrina, subset = katrina$reason !=0)
ggsurvplot(katrina_reason, conf.int = FALSE,
palette='Strata'
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette='Strata'
)
palette=c("#e41a1c", "#377eb8","#4daf4a","#984ea3"
palette=c("#689EB8", "#377eb8","#4daf4a","#984ea3"
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#377eb8","#4daf4a","#984ea3"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#4daf4a","#984ea3"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#4daf4a","#984ea3"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#FCBD34", "#A79B94","#FF5A60","#984ea3"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#FCBD34", "#A79B94","#FF5A60","#689EB8"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#FCBD34", "#819975","#FF5A60","#689EB8"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#FCBD34", "#819975","#DE6D43","#689EB8"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#FCBD34", "#A79B94","#FF5A60","#689EB"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3")
xlab = "Time (in hours)",
legend ("topright", col = 1:4, legend = levels(factor(reason)))
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3")
xlab = "Time (in hours)",
legend ("topright", col = 1:4, legend = levels(factor(reason))
))
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"),
xlab = "Time (in hours)",
legend ("topright", col = 1:4)
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"),
xlab = "Time (in hours)",
legend ("topright", col = 1:4, legend = levels(factor(reason)))
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"),
xlab = "Time (in hours)",
legend ("topright", col = 1:4, legend = levels(factor(katrina$reason)))
)
ggsurvplot(katrina_reason, conf.int = FALSE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"),
xlab = "Time (in hours)",
legend ("topright", col = 1:4, legend = levels(factor(katrina$reason)))
)
ggsurvplot(katrina_reason, conf.int = FALSE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"),
xlab = "Time (in hours)",
legend ("topright", col = 1:4, legend = c("Reason 1", "Reason 2", "Reason 3", "Reason 4"))
)
ggsurvplot(katrina_reason, conf.int = FALSE,
palette=c("#689EB8", "#A79B94","#FF5A60","#984ea3"),
xlab = "Time (in hours)"
#legend ("topright", col = 1:4, legend = c("Reason 1", "Reason 2", "Reason 3", "Reason 4"))
)
ggsurvplot(katrina_reason, conf.int = FALSE,
palette=c("#F4CC70", "#DE7A22","#20948B","#6AB187"),
xlab = "Time (in hours)"
#legend ("topright", col = 1:4, legend = c("Reason 1", "Reason 2", "Reason 3", "Reason 4"))
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#6AB187"),
xlab = "Time (in hours)"
#legend ("topright", col = 1:4, legend = c("Reason 1", "Reason 2", "Reason 3", "Reason 4"))
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#BA5536"),
xlab = "Time (in hours)"
#legend ("topright", col = 1:4, legend = c("Reason 1", "Reason 2", "Reason 3", "Reason 4"))
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)"
#legend ("topright", col = 1:4, legend = c("Reason 1", "Reason 2", "Reason 3", "Reason 4"))
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)"
#legend ("topright", col = 1:4, legend = c("Reason 1", "Reason 2", "Reason 3", "Reason 4"))
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = 'Reason for Pump Failure'
legend.labs = c(1,2,3,4)
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure"
legend.labs = c(1,2,3,4)
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4)
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
ggtheme = theme_bw()
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw()
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw()
Title = "Survival Probability Plot Stratify by Reason"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Title = "Pump Failure Kaplan-Meier Curve by Reason"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Main = "Pump Failure Kaplan-Meier Curve by Reason"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Main = "Pump Failure Kaplan-Meier Curve by Reason",
mark.time = TRUE
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Main = "Pump Failure Kaplan-Meier Curve by Reason"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Main = "Pump Failure Kaplan-Meier Curve by Reason"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Main = "this is the title"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Title = "this is the title"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
Title = "this is the title"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
title = "this is the title"
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
legend = "bottom",
ggtheme = theme_bw(),
title = "Kaplan-Meier Curve Stratify by Failure Reason"
)
# log-rank test
survdiff(Surv(katrina$hour, katrina$survive==0) ~ katrina$reason, rho = 0, data = katrina, subset = katrina$reason != 0)
# pairwise comparison
pairwise_survdiff(Surv(time = hour, event = survive == 0) ~ reason, rho = 0, data = katrina[katrina$reason != 0,])
# here, i am making a new variable hour2, where i'm setting censored observations
# to have hour2 = 49 so that the function doesn't plot them as if they all had
# the event in the last week
katrina$hour2 <- ifelse(katrina$hour == 48 & katrina$survive == 1, 49, katrina$hour)
# create a new variable survive2 that is the opposite of survive
### we did this because kphaz.fit() automatically assumes 0 is censored
### and 1 is the event, and it doesn't look like this can be changed.
katrina$survive2 <- ifelse(katrina$survive==0, 1, 0)
# kphaz.fit() has the same arguments as Surv()
katrina_haz <- with(katrina, kphaz.fit(hour2, survive2))
# and we plot it with kphaz.plot()
kphaz.plot(katrina_haz, main = "hazard function")
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
ggtheme = theme_bw()
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
ggtheme = theme_bw()
)
ggsurvplot(katrina_reason, conf.int = TRUE,
palette=c("#F4CC70", "#DE7A22","#20948B","#A43820"),
xlab = "Time (in hours)",
legend.title = "Reason for Pump Failure",
legend.labs = c(1,2,3,4),
ggtheme = theme_bw()
)
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "grey")
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "grey",
legend.title = "Reason for Pump Failure"
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "grey",
legend.title = "Reason for Pump Failure",
ggtheme = theme_bw()
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "#F4CC70",
legend.title = "Reason for Pump Failure",
ggtheme = theme_bw()
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "#DE7A22",
legend.title = "Reason for Pump Failure",
ggtheme = theme_bw()
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "#20948B",
legend.title = "Reason for Pump Failure",
ggtheme = theme_bw()
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "#A43820",
legend.title = "Reason for Pump Failure",
ggtheme = theme_bw()
)
#plot the survival curve with no stratification
ggsurvplot(katrina_fit, data = katrina, xlab= "Time (in hours)",
conf.int = TRUE, palette = "#20948B",
legend.title = "Reason for Pump Failure",
ggtheme = theme_bw()
)
# and we plot it with kphaz.plot()
kphaz.plot(katrina_haz, main = "hazard function")
### cumulative hazard ###
ggsurvplot(katrina_fit, fun = "cumhaz", palette = "grey")
# and we plot it with kphaz.plot()
kphaz.plot(katrina_haz, main = "hazard function")
### cumulative hazard ###
ggsurvplot(katrina_fit, fun = "cumhaz", palette = "grey")
